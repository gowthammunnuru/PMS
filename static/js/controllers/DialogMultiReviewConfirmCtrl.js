// Generated by CoffeeScript 1.8.0
angular.module("perform").controller("DialogMultiReviewConfirmCtrl", [
  "$scope", "$modal", "$modalInstance", "reviews", "$state", function($scope, $modal, $modalInstance, reviews, $state) {
    $scope.okToProceed = false;
    $scope.reviews = reviews;
    $scope.groups = _.groupBy(reviews, function(x) {
      return "" + x.year + "-" + x.rname + "-" + x.review_type + "-" + x.template_id;
    });
    $scope.$watch('groups', function(newValue, oldValue) {
      if (_.keys($scope.groups).length === 1) {
        return $scope.okToProceed = true;
      }
    });
    $scope.goToMultiReview = function(reviews) {
      var uids, x;
      uids = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = reviews.length; _i < _len; _i++) {
          x = reviews[_i];
          _results.push(x.uid);
        }
        return _results;
      })();
      $state.go('multi_user_review_year.start', {
        uids: uids.join('+'),
        review_year: reviews[0].year,
        review_name: reviews[0].rname
      });
      return $scope.ok();
    };
    $scope.removeGroup = function(key) {
      return delete $scope.groups[key];
    };
    $scope.cancel = function() {
      return $modalInstance.dismiss('cancel');
    };
    $scope.ok = function() {
      return $modalInstance.close();
    };
  }
]);
