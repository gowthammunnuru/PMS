// Generated by CoffeeScript 1.9.1
angular.module("perform").controller("UserReviewPreviewCtrl", [
  "$scope", "$stateParams", "WS", "Portal", "Utils", "user", "$state", "Cache", "Auth", "Reviews", "review", function($scope, $stateParams, WS, Portal, Utils, user, $state, Cache, Auth, Reviews, review) {
    var ref, section, sectionName;
    if (review != null ? review.latest_template : void 0) {
      $scope.sections = (function() {
        var ref, results;
        ref = review.latest_template.section;
        results = [];
        for (sectionName in ref) {
          section = ref[sectionName];
          results.push(section);
        }
        return results;
      })();
      $scope.template_id = review.latest_template.template_id;
      console.log($scope.sections);
    }
    $scope.review_metadata = review.metadata;
    $scope.latest_review = review.latest_review;
    $scope.review_type = $state.current.data.review_type;
    $scope.review = Reviews.getset(review.latest_review, $scope.review_type);
    $scope.review_payload = review;
    if ((ref = $state.$current.data) != null ? ref.section : void 0) {
      $scope.sectionName = $state.$current.data.section;
    } else {
      $scope.sectionName = $stateParams.section;
    }
    $scope.restrictedAccess = (Auth.getUser().uid === $scope.user.uid) && ($scope.review_type === 'review');
    $scope.user = user;
    $scope.review_year = $stateParams.review_year;
    $scope.review_name = $stateParams.review_name;
    $scope.last_edit_time = Utils.localtime(review.latest_review.datetime).format('LLL');
    $scope.goToReview = function(review) {
      var state;
      if (review.review_type === 'self-review') {
        state = 'user_self_review_year.start';
      } else {
        state = 'user_review_year.start';
      }
      return $state.go(state, {
        uid: review.uid,
        review_year: review.year,
        review_name: review.rname
      });
    };
  }
]);
